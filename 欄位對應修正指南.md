# ğŸ“Š æ¬„ä½å°æ‡‰ä¿®æ­£æŒ‡å—

## ğŸš¨ å•é¡Œæè¿°

ä½ ç™¼ç¾ç¨‹å¼å°æ‡‰è¡¨æ ¼æ¬„ä½å¡«å…¥æœ‰ä»¥ä¸‹éŒ¯èª¤ï¼š

1. **Cæ¬„ä½ (Currency)** - æ‡‰è©²æ˜¯å¹£åˆ¥é¸æ“‡ (TWD, JPY, USD, EUR, CNY)ï¼Œä½†ç¾åœ¨å¡«å…¥äº†ã€Œå“é …é—œéµå­—ã€
2. **Dæ¬„ä½ (Exchange Rate)** - æ‡‰è©²æ˜¯åŒ¯ç‡ï¼ŒTWD=1ï¼Œå…¶ä»–å¹£åˆ¥éœ€è¦å³æ™‚åŒ¯ç‡
3. **Eæ¬„ä½ (Amount TWD)** - æ‡‰è©²ç”±å…¬å¼ `=B*D` è‡ªå‹•è¨ˆç®—å°å¹£é‡‘é¡
4. **Fæ¬„ä½ (Category)** - æ‡‰è©²æ˜¯æ¶ˆè²»é¡åˆ¥ (é£Ÿè¡£ä½è¡Œè‚²æ¨‚é†«ç™‚ä¿éšªå…¶ä»–)

## âœ… æ­£ç¢ºçš„æ¬„ä½å°æ‡‰

| æ¬„ä½ | åç¨± | å…§å®¹ | ç¯„ä¾‹ |
|------|------|------|------|
| A | Date | æ—¥æœŸ | 2025-01-25 |
| B | Amount | åŸå§‹é‡‘é¡ | 150 |
| C | Currency | å¹£åˆ¥ä»£ç¢¼ | TWD, JPY, USD, EUR, CNY |
| D | Exchange Rate | åŒ¯ç‡ | 1 (TWD), 0.21 (JPY) |
| E | Amount (TWD) | å°å¹£é‡‘é¡ | ç”±å…¬å¼ `=B2*D2` è¨ˆç®— |
| F | Category | æ¶ˆè²»é¡åˆ¥ | é£Ÿã€è¡£ã€ä½ã€è¡Œã€è‚²ã€æ¨‚ã€é†«ç™‚ã€ä¿éšªã€å…¶ä»– |
| G | Description | æè¿° | æ˜Ÿå·´å…‹å’–å•¡ |
| H | Merchant | å•†å®¶ | æ˜Ÿå·´å…‹ |

## ğŸ”§ ç«‹å³ä¿®æ­£æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ç¾æœ‰è¡¨æ ¼çµæ§‹

```javascript
// åœ¨ Google Apps Script ä¸­åŸ·è¡Œ
function checkTableStructure() {
  const ss = SpreadsheetApp.openById('ä½ çš„è¡¨æ ¼ID');
  const sheet = ss.getSheetByName('All Records');
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  
  console.log('ç›®å‰è¡¨æ ¼æ¨™é¡Œ:');
  headers.forEach((header, index) => {
    const column = String.fromCharCode(65 + index);
    console.log(`${column} æ¬„ä½: ${header}`);
  });
}
```

### æ­¥é©Ÿ 2ï¼šä¿®æ­£éŒ¯èª¤çš„æ¬„ä½è³‡æ–™

```javascript
// ä¿®æ­£ç¾æœ‰éŒ¯èª¤è³‡æ–™
function fixExistingColumnMapping() {
  const ss = SpreadsheetApp.openById('ä½ çš„è¡¨æ ¼ID');
  const sheet = ss.getSheetByName('All Records');
  const dataRange = sheet.getDataRange();
  const values = dataRange.getValues();
  
  const validCurrencies = ['TWD', 'JPY', 'USD', 'EUR', 'CNY'];
  let fixedRows = 0;
  
  for (let i = 1; i < values.length; i++) {
    const row = values[i];
    const cValue = row[2]; // C æ¬„ä½
    
    // å¦‚æœ C æ¬„ä½ä¸æ˜¯æœ‰æ•ˆå¹£åˆ¥ï¼Œä¿®æ­£ç‚º TWD
    if (cValue && !validCurrencies.includes(cValue)) {
      sheet.getRange(i+1, 3).setValue('TWD');
      sheet.getRange(i+1, 4).setValue(1); // è¨­å®šåŒ¯ç‡ç‚º 1
      fixedRows++;
    }
  }
  
  console.log(`ä¿®æ­£äº† ${fixedRows} è¡Œè³‡æ–™`);
}
```

### æ­¥é©Ÿ 3ï¼šé‡æ–°è¨­å®š E æ¬„ä½å…¬å¼

```javascript
// ç¢ºä¿ E æ¬„ä½å…¬å¼æ­£ç¢º
function fixAmountFormula() {
  const ss = SpreadsheetApp.openById('ä½ çš„è¡¨æ ¼ID');
  const sheet = ss.getSheetByName('All Records');
  
  // è¨­å®š E æ¬„ä½æ¨™é¡Œå’Œå…¬å¼
  sheet.getRange('E1').setValue('Amount (TWD)');
  sheet.getRange('E2').setFormula('={"Amount (TWD)"; ARRAYFORMULA(IF(ISBLANK(A2:A),, B2:B * D2:D))}');
  
  console.log('E æ¬„ä½å…¬å¼å·²é‡æ–°è¨­å®š');
}
```

## ğŸ¤– AI Prompt å·²ä¿®æ­£

æˆ‘å·²ç¶“ä¿®æ­£äº† AI çš„ promptï¼Œç¾åœ¨æœƒæ›´åš´æ ¼åœ°æŒ‡å°ï¼š

### èªéŸ³è¨˜å¸³ AI æŒ‡ç¤º
- **currency æ¬„ä½**ï¼šåªèƒ½æ˜¯ TWD, JPY, USD, EUR, CNYï¼Œçµ•å°ä¸å¡«å•†å“åç¨±
- **category æ¬„ä½**ï¼šæ ¹æ“šæ¶ˆè²»å…§å®¹åˆ¤æ–·ç‚º é£Ÿã€è¡£ã€ä½ã€è¡Œã€è‚²ã€æ¨‚ã€é†«ç™‚ã€ä¿éšªã€å…¶ä»–

### åœ–ç‰‡è¨˜å¸³ AI æŒ‡ç¤º  
- **currency æ¬„ä½**ï¼šæ ¹æ“šæ”¶æ“šå¹£åˆ¥ç¬¦è™Ÿåˆ¤æ–· (NT$â†’TWD, Â¥â†’JPY ç­‰)
- **category æ¬„ä½**ï¼šæ ¹æ“šå•†å“é¡å‹è‡ªå‹•åˆ†é¡

## ğŸ“‹ æ¸¬è©¦é©—è­‰

### æ¸¬è©¦èªéŸ³è¨˜å¸³
```
è¼¸å…¥ï¼šã€Œæˆ‘ä»Šå¤©è²·äº†ä¸€æ¯å’–å•¡èŠ±äº†150å…ƒã€
æœŸæœ›è¼¸å‡ºï¼š
- Cæ¬„ä½: TWD
- Fæ¬„ä½: é£Ÿ
```

### æ¸¬è©¦æ‹ç…§è¨˜å¸³
```
æ‹æ”ï¼šæ˜Ÿå·´å…‹æ”¶æ“š
æœŸæœ›è¼¸å‡ºï¼š
- Cæ¬„ä½: TWD (æ ¹æ“š NT$ ç¬¦è™Ÿ)
- Fæ¬„ä½: é£Ÿ (å’–å•¡å±¬æ–¼é£Ÿç‰©é¡åˆ¥)
```

## ğŸš€ å®Œæ•´ä¿®æ­£è…³æœ¬

```javascript
/**
 * ä¸€éµä¿®æ­£æ‰€æœ‰æ¬„ä½å°æ‡‰å•é¡Œ
 */
function fixAllColumnMappingIssues() {
  console.log('=== é–‹å§‹ä¿®æ­£æ¬„ä½å°æ‡‰å•é¡Œ ===');
  
  try {
    // 1. æª¢æŸ¥è¡¨æ ¼çµæ§‹
    checkTableStructure();
    
    // 2. ä¿®æ­£éŒ¯èª¤è³‡æ–™
    fixExistingColumnMapping();
    
    // 3. é‡æ–°è¨­å®šå…¬å¼
    fixAmountFormula();
    
    // 4. æ¸¬è©¦æ–°çš„ AI è™•ç†
    testNewAIProcessing();
    
    console.log('âœ… æ‰€æœ‰æ¬„ä½å°æ‡‰å•é¡Œå·²ä¿®æ­£å®Œæˆ');
    
  } catch (error) {
    console.log(`âŒ ä¿®æ­£éç¨‹ç™¼ç”ŸéŒ¯èª¤: ${error.toString()}`);
  }
  
  console.log('=== æ¬„ä½å°æ‡‰ä¿®æ­£å®Œæˆ ===');
}

function testNewAIProcessing() {
  // æ¸¬è©¦èªéŸ³è™•ç†
  const testVoice = 'æˆ‘è²·äº†ä¸€æ¯å’–å•¡èŠ±äº†150å…ƒ';
  console.log(`æ¸¬è©¦èªéŸ³: ${testVoice}`);
  
  // é€™è£¡æœƒä½¿ç”¨ä¿®æ­£å¾Œçš„ AI prompt
  // æœŸæœ› Cæ¬„ä½=TWD, Fæ¬„ä½=é£Ÿ
}
```

## ğŸ“ è«‹æä¾›ä½ çš„ CSV æª”æ¡ˆ

ç‚ºäº†æ›´ç²¾ç¢ºåœ°è¨ºæ–·å•é¡Œï¼Œè«‹æä¾›ä½ çš„è¡¨æ ¼ CSV æª”æ¡ˆå…§å®¹ï¼Œæˆ‘å¯ä»¥ï¼š

1. **åˆ†æå…·é«”çš„éŒ¯èª¤è³‡æ–™**
2. **æä¾›é‡å°æ€§çš„ä¿®æ­£è…³æœ¬**  
3. **ç¢ºä¿ä¿®æ­£å¾Œçš„çµæœç¬¦åˆä½ çš„éœ€æ±‚**

ä½ å¯ä»¥ï¼š
- ç›´æ¥è²¼ä¸Š CSV å…§å®¹
- æ‹–æ‹‰æª”æ¡ˆåˆ°èŠå¤©æ¡†
- æˆ–è€…å‘Šè¨´æˆ‘å‰å¹¾è¡Œçš„å…§å®¹

## ğŸ¯ ä¿®æ­£å¾Œçš„æ•ˆæœ

ä¿®æ­£å®Œæˆå¾Œï¼Œä½ çš„è¡¨æ ¼å°‡æœƒï¼š

- âœ… Cæ¬„ä½åªåŒ…å«æœ‰æ•ˆå¹£åˆ¥ä»£ç¢¼ (TWD, JPY, USD, EUR, CNY)
- âœ… Dæ¬„ä½é¡¯ç¤ºæ­£ç¢ºåŒ¯ç‡ (TWD=1, å…¶ä»–ç‚ºå³æ™‚åŒ¯ç‡)
- âœ… Eæ¬„ä½è‡ªå‹•è¨ˆç®—å°å¹£é‡‘é¡ (=B*D)
- âœ… Fæ¬„ä½é¡¯ç¤ºæ­£ç¢ºé¡åˆ¥ (é£Ÿè¡£ä½è¡Œè‚²æ¨‚é†«ç™‚ä¿éšªå…¶ä»–)
- âœ… æ–°çš„è¨˜å¸³è³‡æ–™æœƒæ­£ç¢ºå¡«å…¥å°æ‡‰æ¬„ä½

éœ€è¦æˆ‘ç«‹å³åŸ·è¡Œä¿®æ­£è…³æœ¬å—ï¼Ÿ