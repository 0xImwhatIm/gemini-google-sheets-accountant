# iOS 捷徑設定指南 - 智慧記帳 GEM

## 概述

本指南將教您如何設定三種不同的 iOS 捷徑來與智慧記帳 GEM 系統整合：
1. **語音記帳**：快速語音輸入交易記錄
2. **收據拍照記帳**：拍攝收據自動解析記帳
3. **收據拍照＋語音補充記帳**：拍攝收據並添加語音說明

## 前置準備

### 1. 獲取您的 API URL
1. 登入您的 Google Apps Script 專案
2. 點擊「部署」→「新增部署」
3. 選擇類型為「網頁應用程式」
4. 設定執行身分為「我」，存取權限為「任何人」
5. 複製生成的網頁應用程式 URL（格式如：`https://script.google.com/macros/s/AKfyc...../exec`）

### 2. 安裝 iOS 捷徑應用
- 確保您的 iPhone/iPad 已安裝「捷徑」應用
- iOS 版本需要 13.0 以上

---

## 情境一：語音記帳捷徑

### 設定步驟

1. **開啟捷徑應用**，點擊右上角「+」建立新捷徑

2. **設定捷徑名稱**
   - 點擊「新捷徑」標題
   - 輸入名稱：「語音記帳」
   - 選擇合適的圖示和顏色

3. **添加語音輸入動作**
   - 點擊「加入動作」
   - 搜尋「聽寫文字」並添加
   - 設定提示文字：「請說出您的交易內容，例如：我今天買了一杯咖啡花了150元」
   - 語言設定為「繁體中文」

4. **添加 URL 編碼動作**
   - 搜尋「編碼 URL」並添加
   - 輸入來源選擇「聽寫的文字」

5. **添加文字處理動作**
   - 搜尋「文字」並添加
   - 在文字框中輸入：
   ```
   https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?endpoint=voice&text=編碼的 URL
   ```
   - 將 `YOUR_DEPLOYMENT_ID` 替換為您的實際部署 ID
   - 點擊「編碼的 URL」選擇變數

6. **添加網路請求動作**
   - 搜尋「取得 URL 內容」並添加
   - URL 來源選擇「文字」
   - 方法保持「GET」
   - 標頭留空

7. **添加結果顯示動作**
   - 搜尋「顯示通知」並添加
   - 標題設為「記帳完成」
   - 內容選擇「URL 的內容」

### 使用方法
1. 在主畫面或控制中心點擊「語音記帳」捷徑
2. 對著手機說出交易內容，例如：「我今天買了一杯咖啡花了150元」
3. 等待處理完成，查看通知結果

---

## 情境二：收據拍照記帳捷徑

### 設定步驟

1. **建立新捷徑**
   - 名稱：「拍照記帳」
   - 選擇相機圖示

2. **添加拍照動作**
   - 搜尋「拍照」並添加
   - 或者使用「從相簿選擇照片」（如果想選擇現有照片）

3. **添加圖片編碼動作**
   - 搜尋「編碼為 Base64」並添加
   - 輸入來源選擇「照片」

4. **添加 JSON 構建動作**
   - 搜尋「取得字典的值」並添加
   - 點擊「字典」，添加以下鍵值對：
     - 鍵：`image`，值：選擇「Base64 編碼」
     - 鍵：`filename`，值：輸入文字「receipt.jpg」

5. **添加網路請求動作**
   - 搜尋「取得 URL 內容」並添加
   - URL 輸入：
   ```
   https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?endpoint=image
   ```
   - 方法選擇「POST」
   - 請求內文選擇「字典」
   - 標頭添加：
     - 鍵：`Content-Type`，值：`application/json`

6. **添加結果處理動作**
   - 搜尋「取得字典的值」並添加
   - 字典來源選擇「URL 的內容」
   - 取得鍵：`message`

7. **添加結果顯示動作**
   - 搜尋「顯示通知」並添加
   - 標題：「拍照記帳完成」
   - 內容選擇「字典值」

### 使用方法
1. 點擊「拍照記帳」捷徑
2. 拍攝收據照片或從相簿選擇
3. 等待 AI 解析收據內容
4. 查看處理結果通知

---

## 情境三：收據拍照＋語音補充記帳捷徑

### 設定步驟

1. **建立新捷徑**
   - 名稱：「拍照＋語音記帳」
   - 選擇合適圖示

2. **添加拍照動作**
   - 搜尋「拍照」並添加

3. **添加語音輸入動作**
   - 搜尋「聽寫文字」並添加
   - 提示文字：「請說出補充說明，例如：這是公司聚餐費用」

4. **添加圖片編碼動作**
   - 搜尋「編碼為 Base64」並添加
   - 輸入來源選擇「照片」

5. **添加 JSON 構建動作**
   - 搜尋「取得字典的值」並添加
   - 添加鍵值對：
     - 鍵：`image`，值：選擇「Base64 編碼」
     - 鍵：`filename`，值：輸入「receipt.jpg」
     - 鍵：`voiceNote`，值：選擇「聽寫的文字」

6. **添加網路請求動作**
   - 搜尋「取得 URL 內容」並添加
   - URL：
   ```
   https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?endpoint=image
   ```
   - 方法：POST
   - 請求內文：選擇「字典」
   - 標頭：`Content-Type: application/json`

7. **添加結果顯示動作**
   - 同情境二的結果處理步驟

### 使用方法
1. 點擊「拍照＋語音記帳」捷徑
2. 拍攝收據照片
3. 錄製語音補充說明
4. 等待 AI 綜合處理圖片和語音內容
5. 查看詳細的處理結果

---

## 進階設定

### 錯誤處理設定

為每個捷徑添加錯誤處理：

1. **添加條件判斷**
   - 在「取得 URL 內容」後添加「If」動作
   - 條件：「URL 的內容」包含「error」

2. **錯誤情況處理**
   - If 為真：顯示錯誤通知
   - Otherwise：顯示成功通知

### 快速存取設定

1. **添加到主畫面**
   - 在捷徑設定中點擊「加入到主畫面」
   - 自訂圖示和名稱

2. **添加到控制中心**
   - 設定 → 控制中心 → 自訂控制項目
   - 添加「捷徑」

3. **設定 Siri 語音啟動**
   - 在捷徑設定中點擊「加入到 Siri」
   - 錄製語音指令，例如「開始記帳」

---

## 常見問題排除

### Q1: 語音識別不準確怎麼辦？
**A:** 
- 確保在安靜環境下錄音
- 說話清晰，語速適中
- 可以在「聽寫文字」設定中調整語言和方言

### Q2: 拍照後處理很慢或失敗？
**A:**
- 確保收據照片清晰，光線充足
- 避免照片過大（建議小於 5MB）
- 檢查網路連接是否穩定

### Q3: 收到「API 錯誤」訊息？
**A:**
- 檢查 URL 中的部署 ID 是否正確
- 確認 Google Apps Script 已正確部署
- 檢查 API 金鑰是否有效

### Q4: 捷徑執行到一半就停止？
**A:**
- 檢查所有動作的輸入來源是否正確連接
- 確認網路請求的格式和參數正確
- 查看捷徑的執行日誌找出具體錯誤

### Q5: 如何查看詳細的錯誤資訊？
**A:**
- 在捷徑最後添加「快速查看」動作
- 輸入來源選擇「URL 的內容」
- 這樣可以看到完整的 API 回應

---

## 安全性注意事項

1. **保護您的 API URL**
   - 不要在公開場合分享包含完整 URL 的捷徑
   - 定期更新部署 ID

2. **權限管理**
   - 只授予捷徑必要的權限
   - 定期檢查和清理不使用的捷徑

3. **資料隱私**
   - 語音和圖片資料會傳送到 Google 服務進行處理
   - 避免在敏感環境下使用

---

## 技術支援

如果您在設定過程中遇到問題：

1. **檢查系統需求**
   - iOS 13.0 以上
   - 穩定的網路連接
   - 已安裝並登入 Google 帳戶

2. **聯繫支援**
   - 請提供具體的錯誤訊息
   - 說明您的設定步驟和遇到問題的位置
   - 提供您的 iOS 版本和設備型號

3. **社群支援**
   - 查看常見問題解答
   - 參與用戶社群討論
   - 分享使用經驗和技巧