# V49.5.0 第二階段清理進度報告

## 📊 **當前狀態**

### **函數數量統計**
- **當前函數數量**: 50 個
- **第一階段後**: 35 個 → **第二階段中**: 50 個
- **說明**: 發現還有更多重複函數需要清理

### **已刪除的重複函數 (第二階段)**
1. ✅ `testMOFCSVFormat()` - 重複的 CSV 格式測試
2. ✅ `testRealMOFEmailAttachment()` - 重複的郵件附件測試
3. ✅ `findMOFInvoiceEmails()` - 重複的郵件搜尋功能
4. ✅ `completeMOFInvoiceDiagnosis()` - 過於複雜的診斷功能

## 🎯 **需要刪除的重複函數清單**

### **第三階段：刪除重複的測試和診斷函數**

#### **重複的測試函數**
- `testJsonMode()` - 行 1450 (重複的 JSON 模式測試)
- `finalSystemTestV49_4_2()` - 行 1585 (版本特定測試)
- `diagnoseMOFEmailMatching()` - 行 1652 (重複診斷)
- `comprehensiveEmailSearch()` - 行 1756 (重複搜尋)
- `diagnoseRealCSVFormat()` - 行 1877 (重複 CSV 診斷)
- `manualEmailCheck()` - 行 2001 (手動檢查指南)
- `testEmailRuleMatching()` - 行 2102 (重複規則測試)

#### **重複的修正版本函數**
- `markMOFEmailUnreadAndTest()` - 行 2029 (原版)
- `markMOFEmailUnreadAndTestFixed()` - 行 2327 (修正版1)
- `markMOFEmailUnreadAndTestCorrected()` - 行 2400 (修正版2)
- `quickFixMOFInvoice()` - 行 2297 (原版)
- `quickFixMOFInvoiceCorrected()` - 行 2473 (修正版)

#### **重複的處理函數**
- `testFixedMOFProcessing()` - 行 2177 (保留 `testFixedMOFEmailProcessing`)
- `simpleCSVDiagnosis()` - 行 2234 (簡化版，可保留)

## 🚀 **清理策略**

### **保留的核心函數 (25個目標)**

#### **Web App 端點 (8個)**
- `doGet()`, `doPost()`
- `doGet_Voice()`, `doPost_Voice()`
- `doGet_Image()`, `doPost_Image()`
- `doGet_Pdf()`, `doPost_Pdf()`
- `doGet_Iou()`, `doPost_Iou()`

#### **AI 處理核心 (5個)**
- `callGeminiForVoice()`
- `callGeminiForVision()`
- `callGeminiForEmailBody()`
- `callGeminiForPdf()`
- `callGeminiForIou()`

#### **郵件自動處理 (2個)**
- `processAutomatedEmails()`
- `safeProcessAutomatedEmails()`

#### **財政部電子發票 (2個)**
- `setupMOFInvoiceRule()`
- `processMOFInvoiceCSV()`

#### **IOU 代墊款 (3個)**
- `handleGroupSplit()`
- `handleSettlement()`
- `writeToIouLedger()`

#### **基礎工具 (5個)**
- `safeExecute()`
- `writeToSheet()`
- `getExchangeRate()`
- `extractJsonFromText()`
- `getCurrentTimezoneDateTime()`
- `generatePromptDateInfo()`

#### **系統資訊與測試 (3個)**
- `getVersionInfo()`
- `checkSystemHealth()`
- `testGeminiConnection()` (簡化版)

## 📋 **執行計劃**

### **第三階段清理步驟**
1. 刪除重複的測試函數 (7個)
2. 刪除重複的修正版本函數 (5個)
3. 保留必要的診斷函數 (2個)
4. 最終檢查和語法驗證

### **預期結果**
- **目標函數數量**: 25個
- **清理效果**: 減少 50%
- **維護性**: 大幅提升
- **功能完整性**: 100% 保留

---

**準備進入第三階段清理！** 🎯