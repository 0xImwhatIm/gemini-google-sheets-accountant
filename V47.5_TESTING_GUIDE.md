# 🧪 V47.5 測試指南

## 📋 測試概述
部署 V47.5 後，需要在不同位置進行三種類型的測試。

## 🌐 測試 1：診斷端點測試

### **測試位置：瀏覽器**
1. **獲取部署 URL**
   - Google Apps Script 編輯器
   - 「部署」→「管理部署」
   - 複製網路應用程式 URL

2. **測試步驟**
   ```
   步驟 1: 複製部署 URL
   步驟 2: 在瀏覽器中打開新標籤
   步驟 3: 輸入 URL + ?endpoint=test
   步驟 4: 按 Enter 鍵
   ```

3. **完整測試 URL 格式**
   ```
   https://script.google.com/macros/s/[你的部署ID]/exec?endpoint=test
   ```

4. **成功回應範例**
   ```json
   {
     "status": "success",
     "version": "V47.5.0",
     "message": "配置修復版本正常運行",
     "config": {
       "hasMainLedgerId": true,
       "hasGeminiApiKey": true,
       "timezone": "Asia/Taipei"
     }
   }
   ```

5. **失敗回應範例**
   ```json
   {
     "status": "error",
     "message": "配置錯誤: GEMINI_API_KEY 未設定"
   }
   ```

## 🔧 測試 2：配置測試

### **測試位置：Google Apps Script 編輯器**

#### **步驟詳解**
1. **打開 GAS 編輯器**
   - 前往 script.google.com
   - 打開你的專案

2. **選擇測試函數**
   - 在編輯器上方找到函數下拉選單
   - 選擇 `testV47_5_Configuration`

3. **執行測試**
   - 點擊「執行」按鈕 ▶️
   - 等待執行完成

4. **查看結果**
   - 點擊下方「執行記錄」標籤
   - 查看詳細日誌輸出

#### **成功日誌範例**
```
🧪 === V47.5 配置測試開始 ===
✅ V47.5 配置檢查通過
📋 測試 1: 配置驗證
✅ 配置驗證通過
📋 測試 2: 時區感知功能
✅ 當前日期: 2025-08-07
✅ 昨天日期: 2025-08-06
✅ 時區: Asia/Taipei
📋 測試 3: Google Sheets 連接
✅ Google Sheets 連接成功
🎉 === V47.5 配置測試完成 ===
```

#### **失敗日誌範例**
```
❌ 配置錯誤: MAIN_LEDGER_ID 未設定
❌ Google Sheets 連接失敗: Invalid sheet ID
```

## 📸 測試 3：圖片處理測試

### **測試位置：Google Apps Script 編輯器**

#### **步驟詳解**
1. **選擇測試函數**
   - 在函數下拉選單中選擇 `testV47_5_ImageProcessing`

2. **執行測試**
   - 點擊「執行」按鈕 ▶️

3. **查看結果**
   - 檢查執行記錄中的日誌

#### **成功日誌範例**
```
🧪 === V47.5 圖片記帳功能測試開始 ===
📋 開始測試 V47.5 圖片處理...
[V47.5-Vision] 開始處理圖片，語音備註: V47.5 測試圖片
[V47.5-Vision] 使用 API 端點: gemini-1.5-flash-latest
[V47.5-Vision] API 回應狀態: 200
[V47.5-Vision] ✅ JSON 解析成功
✅ V47.5 圖片處理測試成功
📝 解析後的資料：
  日期: 2025-08-07 14:30:00
  金額: 0
  類別: 其他
```

## 📱 測試 4：iOS 捷徑功能測試

### **測試位置：iPhone/iPad**

#### **語音記帳測試**
1. **打開捷徑應用**
2. **找到語音記帳捷徑**
3. **點擊運行**
4. **說測試語音**：「我今天買咖啡花了 150 元」
5. **檢查結果**：
   - 捷徑應顯示成功訊息
   - Google Sheets 中應出現新記錄

#### **拍照記帳測試**
1. **找到拍照記帳捷徑**
2. **點擊運行**
3. **拍攝測試照片**（任何有文字的圖片）
4. **檢查結果**：
   - 不應出現 404 錯誤
   - 應顯示處理成功訊息
   - Google Sheets 中應出現新記錄

## 🚨 故障排除

### **診斷端點測試失敗**
**症狀**：瀏覽器顯示錯誤或空白頁面
**解決**：
1. 檢查 URL 是否正確
2. 確認已正確部署
3. 檢查部署權限設定

### **配置測試失敗**
**症狀**：執行記錄顯示配置錯誤
**解決**：
1. 檢查指令碼屬性設定
2. 確認 API 金鑰有效
3. 檢查 Google Sheet ID 正確

### **圖片處理測試失敗**
**症狀**：API 回應狀態非 200
**解決**：
1. 檢查 Gemini API 金鑰
2. 確認 API 配額充足
3. 檢查網路連接

### **iOS 捷徑測試失敗**
**症狀**：仍然出現 404 錯誤
**解決**：
1. 確認使用最新部署 URL
2. 等待 2-3 分鐘讓部署生效
3. 重新運行捷徑

## ✅ 測試檢查清單

### **部署後立即測試**
- [ ] 診斷端點回應正常
- [ ] 配置測試通過
- [ ] 圖片處理測試通過

### **功能驗證測試**
- [ ] 語音記帳功能正常
- [ ] 拍照記帳不出現 404 錯誤
- [ ] Google Sheets 正確寫入資料

### **穩定性測試**
- [ ] 連續測試 3-5 次都成功
- [ ] 不同時間測試都正常
- [ ] 各種類型的輸入都能處理

---
**重要提醒**：所有測試都通過後，才建議進行文件清理工作。