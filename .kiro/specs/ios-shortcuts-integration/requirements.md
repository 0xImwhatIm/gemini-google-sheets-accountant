# iOS 捷徑整合需求文件

## 簡介

本文件定義了智慧記帳 GEM 系統與 iOS 捷徑的整合需求，支援三種主要記帳情境：語音記帳、收據拍照記帳，以及收據拍照加語音補充說明記帳。

## 需求

### 需求 1：語音記帳捷徑

**用戶故事：** 作為一個用戶，我想要通過 iOS 捷徑快速進行語音記帳，這樣我就能在不打開應用的情況下記錄交易。

#### 驗收標準

1. WHEN 用戶啟動語音記帳捷徑 THEN 系統 SHALL 提示用戶進行語音輸入
2. WHEN 用戶完成語音輸入 THEN 系統 SHALL 將語音轉換為文字
3. WHEN 語音文字準備就緒 THEN 系統 SHALL 通過 GET 請求發送到 Google Apps Script
4. WHEN 請求成功處理 THEN 系統 SHALL 顯示成功確認訊息
5. WHEN 請求失敗 THEN 系統 SHALL 顯示錯誤訊息並提供重試選項
6. WHEN 交易記錄成功 THEN 資料 SHALL 出現在指定的 Google Sheet 中

### 需求 2：收據拍照記帳捷徑

**用戶故事：** 作為一個用戶，我想要通過 iOS 捷徑拍攝收據並自動記帳，這樣我就能快速處理紙本收據。

#### 驗收標準

1. WHEN 用戶啟動拍照記帳捷徑 THEN 系統 SHALL 開啟相機或相簿選擇
2. WHEN 用戶選擇或拍攝照片 THEN 系統 SHALL 將圖片轉換為 base64 格式
3. WHEN 圖片準備就緒 THEN 系統 SHALL 通過 POST 請求發送到 Google Apps Script
4. WHEN 請求包含圖片資料 THEN 系統 SHALL 使用 Gemini Vision API 解析收據內容
5. WHEN 解析完成 THEN 系統 SHALL 將交易資料寫入 Google Sheet
6. WHEN 處理完成 THEN 系統 SHALL 顯示解析結果和確認訊息

### 需求 3：收據拍照加語音補充記帳捷徑

**用戶故事：** 作為一個用戶，我想要拍攝收據並添加語音補充說明，這樣我就能提供更完整的交易資訊。

#### 驗收標準

1. WHEN 用戶啟動組合記帳捷徑 THEN 系統 SHALL 先提示拍攝或選擇收據照片
2. WHEN 照片選擇完成 THEN 系統 SHALL 提示用戶進行語音補充說明
3. WHEN 語音錄製完成 THEN 系統 SHALL 將語音轉換為文字
4. WHEN 圖片和語音文字都準備就緒 THEN 系統 SHALL 組合資料並發送 POST 請求
5. WHEN 請求包含圖片和語音資料 THEN 系統 SHALL 使用兩種資料源進行綜合分析
6. WHEN 分析完成 THEN 系統 SHALL 將豐富的交易資料寫入 Google Sheet
7. WHEN 處理完成 THEN 系統 SHALL 顯示詳細的處理結果

### 需求 4：錯誤處理和用戶體驗

**用戶故事：** 作為一個用戶，我想要在捷徑執行過程中獲得清晰的反饋，這樣我就能了解操作狀態並在出錯時知道如何處理。

#### 驗收標準

1. WHEN 網路連接失敗 THEN 系統 SHALL 顯示網路錯誤訊息
2. WHEN API 金鑰無效 THEN 系統 SHALL 顯示認證錯誤訊息
3. WHEN 語音識別失敗 THEN 系統 SHALL 提供手動輸入選項
4. WHEN 圖片解析失敗 THEN 系統 SHALL 提示用戶重新拍攝或手動輸入
5. WHEN 資料寫入失敗 THEN 系統 SHALL 保存資料並提供重試機制
6. WHEN 操作成功 THEN 系統 SHALL 顯示簡潔的成功訊息和摘要資訊

### 需求 5：配置和安全性

**用戶故事：** 作為一個用戶，我想要安全地配置捷徑，這樣我的 API 金鑰和個人資料就能得到保護。

#### 驗收標準

1. WHEN 用戶首次設定捷徑 THEN 系統 SHALL 提供配置嚮導
2. WHEN 用戶輸入 API URL THEN 系統 SHALL 驗證 URL 格式的正確性
3. WHEN 用戶測試連接 THEN 系統 SHALL 發送測試請求並顯示結果
4. WHEN 捷徑包含敏感資訊 THEN 系統 SHALL 使用 iOS 捷徑的安全存儲機制
5. WHEN 用戶分享捷徑 THEN 系統 SHALL 確保不包含個人 API 金鑰
6. WHEN 捷徑執行 THEN 系統 SHALL 使用 HTTPS 進行所有網路通信

### 需求 6：多語言和本地化支援

**用戶故事：** 作為一個繁體中文用戶，我想要捷徑界面和提示訊息都使用繁體中文，這樣我就能更好地理解和使用功能。

#### 驗收標準

1. WHEN 捷徑在繁體中文環境執行 THEN 所有提示訊息 SHALL 使用繁體中文
2. WHEN 系統顯示錯誤訊息 THEN 錯誤訊息 SHALL 使用用戶的本地語言
3. WHEN 語音識別處理中文 THEN 系統 SHALL 正確處理繁體中文語音輸入
4. WHEN 顯示成功訊息 THEN 訊息格式 SHALL 符合中文使用習慣
5. WHEN 處理貨幣資訊 THEN 系統 SHALL 預設使用台幣（TWD）
6. WHEN 處理日期格式 THEN 系統 SHALL 使用本地化的日期格式

## 技術約束

1. **iOS 版本支援**：支援 iOS 13.0 以上版本
2. **網路需求**：需要穩定的網路連接
3. **權限需求**：需要相機、麥克風和網路存取權限
4. **資料格式**：圖片支援 JPEG/PNG，語音轉文字使用 iOS 內建功能
5. **API 限制**：遵循 Google Apps Script 的執行時間和頻率限制
6. **安全性**：所有通信使用 HTTPS，敏感資料加密存儲

## 成功標準

1. **可用性**：普通用戶能在 5 分鐘內完成捷徑設定
2. **可靠性**：捷徑成功率達到 95% 以上
3. **效能**：語音記帳在 10 秒內完成，拍照記帳在 30 秒內完成
4. **準確性**：語音識別準確率達到 90% 以上，收據解析準確率達到 85% 以上
5. **用戶滿意度**：用戶反饋評分達到 4.5/5.0 以上